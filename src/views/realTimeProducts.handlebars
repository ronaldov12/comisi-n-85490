<!-- enlace al carrito -->
<a href="/carts/6886ef1fb5b6c69e9e334ad3" style="display:inline-block; margin-bottom: 15px; font-weight: bold; color: blue;">
    Ir al carrito ðŸ›’
</a>

<h1>Productos en tiempo real disponibles</h1>

<!-- formulario para crear nuevo producto -->
<form id="productForm">
    <input name="title" placeholder="TÃ­tulo" required />
    <input name="description" placeholder="DescripciÃ³n" required />
    <input name="code" placeholder="CÃ³digo" required />
    <input name="price" type="number" step="0.01" placeholder="Precio" required />
    <input name="stock" type="number" placeholder="Stock" />
    <input name="category" placeholder="CategorÃ­a" />
    <label>
        <input type="checkbox" name="status" />
        Disponible
    </label>
    <button type="submit">Crear producto</button>
</form>

<hr />

<ul id="productList">
    {{#each products}}
    <li>
        <strong>{{this.title}}</strong> â€“ ${{this.price}}<br />
        <em>{{this.description}}</em><br />
        <a href="/products/{{this._id}}">Ver detalle</a>
    </li>
    {{/each}}
</ul>

<!-- carga de socket.io diferida -->
<script src="/socket.io/socket.io.js" defer></script>

<!-- logica de cliente espera a que el dom este listo -->
<script defer>
    document.addEventListener('DOMContentLoaded', () => {
        const socket = io();
        const form = document.getElementById('productForm');
        const list = document.getElementById('productList');

        form.addEventListener('submit', e => {
            e.preventDefault();
            const formData = new FormData(form);
            formData.set('status', formData.get('status') === 'on');
            const product = Object.fromEntries(formData.entries());
            socket.emit('newProduct', product);
            form.reset();
        });

        socket.on('updateProducts', products => {
            list.innerHTML = '';
            products.forEach(p => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${p.title}</strong> â€“ $${p.price}<br />
                    <em>${p.description}</em><br />
                    <a href="/products/${p._id}">Ver detalle</a>
                `;
                list.appendChild(li);
            });
        });
    });
</script>
